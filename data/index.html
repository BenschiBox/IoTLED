<!DOCTYPE HTML><html>
<head>
	<title>LED - Manager</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="UTF-8">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-deep-orange.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" 
	integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
	
	<!-- Browser / App Favicon --> 
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#757575">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff">	
</head>

<body>
	<!-- Sidebar -->
	<div class="w3-sidebar w3-animate-left w3-bar-block w3-card w3-theme-light" style="display:none" id="sidebar">
		<button onclick="closeSidebar()" class="w3-bar-item w3-large w3-dark-grey">Close &times;</button>
		<a href="#" class="w3-bar-item w3-border-bottom w3-button w3-deep-orange">Link 1</a>
		<a href="#" class="w3-bar-item w3-border-bottom w3-button">Link 2</a>
		<a href="#" class="w3-bar-item w3-border-bottom w3-button">Link 3</a>
	</div>
	
	<!-- Header -->
	<header class="w3-container w3-theme w3-display-container" id="myHeader">
		<button class="w3-button w3-hover-red w3-xlarge" onclick="openSidebar()">â˜°</button>
		<div class="w3-display-middle">
			<h1 class="w3-xlarge w3-animate-bottom">LED - Manager</h1>
		</div>
	</header>

	<!-- third -->
	<div class="w3-row-padding w3-center w3-margin-top">
		<div class="w3-third">
			<div class="w3-card w3-container" style="min-height:460px">
				<h3>Effect</h3><br>
				<i class="fa fa-desktop w3-margin-bottom w3-text-theme" style="font-size:120px"></i>
				<p>Rainbow</p>
				<a id="btnRainbow1" class="w3-button w3-theme">On</a>
				<a id="btnRainbow2" class="w3-button w3-theme">Off</a>
				<br>
				<p>Solid red</p>
				<a id="btnSolid1" class="w3-button w3-theme">On</a>
				<a id="btnSolid2" class="w3-button w3-theme">Off</a>					
			</div>
		</div>

		<div class="w3-third">
			<div class="w3-card w3-container" style="min-height:460px">
				<h3>WebSocket test</h3><br>
				<div class="w3-section">      
				<input id="textbox" class="w3-input" type="text"/>
				<label>Send/Receive - Box</label>
				</div>
				<a id="sendButton" class="w3-button w3-theme">Send</a>
				<input id="slider" type="range" min="0" max="255" value="0" step="5" class="w3-input"/>
				<!-- <a onclick="OpenWebsocket()" id="connectButton" class="w3-button w3-theme">Connect</a>-->
				<!-- <a onclick="CloseWebsocket()" id="disconnectButton" class="w3-button w3-theme w3-disabled">Disconnect</a>-->
			</div>
		</div>

		<div class="w3-third">
			<div class="w3-card w3-container" style="min-height:460px">
				<h3>Design</h3><br>
				<i class="fa fa-diamond w3-margin-bottom w3-text-theme" style="font-size:120px"></i>
				<p>text</p>
				<p>more text</p>
				<p>more fucking text</p>
				<p>even more fucking text</p>
			</div>
		</div>
	</div>
	
	<!-- NAV BAR 
	<div class="w3-bottom">
		<div class="w3-bar"> TODO: function for active page switch
			<a href="#" class="w3-bar-item w3-button w3-mobile w3-green" style="width:33%">Home</a>
			<a href="#" class="w3-bar-item w3-button w3-mobile" style="width:33%">Link 1</a>
			<a href="#" class="w3-bar-item w3-button w3-mobile" style="width:33%">Link 2</a>
		</div>
	</div>
	-->
	
<script>
	// --------------- WebSocket handling ------------
	ws = new WebSocket("ws://192.168.178.6/ws");
	
	ws.onopen = function() {
		//enableElement("textbox");
		//enableElement("sendButton");
		//disableElement("connectButton");
		//enableElement("disconnectButton");
		
		console.log("WS: Connected");
	};
	 
    ws.onclose = function() {
		//disableElement("textbox");
		//disableElement("sendButton");
		//enableElement("connectButton");
		//disableElement("disconnectButton");
		console.log("WS: Connection closed");
	};
	
	ws.onmessage = function(evt) {
		textbox.value = evt.data;
		slider.value = evt.data;
	}
	
	function sendData(data) {
		ws.send(data);
	}
	
	function closeWebsocket() {
		ws.close();
	}
	
	var lastcall = Date.now();
	function msGoneBy(ms) {
		if (ms < 0 || ms === undefined)
		{
			ms = 50;
		}
		
		if (Date.now() - lastcall >= ms)
		{
			lastcall = Date.now();
			return true;
		}
		
		console.log("WS: limiter engaged!");
		return false;
	}
	
	// --------------- Defaults JSON -----------------
	
	var settings;
	function AJAX_JSON_Req()
	{
		var AJAX_req = new XMLHttpRequest();
		AJAX_req.open("GET", "/settings.json", true);
		AJAX_req.setRequestHeader("Content-type", "application/json");
		AJAX_req.onreadystatechange = function() {
			if( AJAX_req.readyState == 4 && AJAX_req.status == 200 )
			{
				settings = JSON.parse( AJAX_req.responseText );
				writeDefaults();
			}
		}
		AJAX_req.send();
	}
	AJAX_JSON_Req();
	
	function writeDefaults() {
		textbox.value = settings.brightness;
		slider.value = settings.brightness;
	}
	
	// --------------- Event handler -----------------
	
	// textbox
	var textbox = document.getElementById('textbox');
	textbox.addEventListener('keyup', function(event) {
		event.preventDefault();
		if (event.keyCode === 13) {
			sendButton.click();
		}
	});
	
	// slider
	var slider = document.getElementById('slider');
	slider.addEventListener('input', function() {
		if (msGoneBy(25)) {
			sendData(slider.value);
		}
	});

	// sendButton
	var sendButton = document.getElementById('sendButton');
	sendButton.addEventListener('click', function() {
		sendData(textbox.value);
	});
	
	// sidebar
	var sidebar = document.getElementById('sidebar');
	function openSidebar() {
		sidebar.style.display = "block";
	}

	function closeSidebar() {
		sidebar.style.display = "none";
	}
	
	// --------------- other functions ---------------
	
	function disableElement(id) {
		var element = document.getElementById(id);
		if (!element.classList.contains('w3-disabled')) {
			element.classList.add('w3-disabled');
		}
	}
	
	function enableElement(id) {
		var element = document.getElementById(id);
		if (element.classList.contains('w3-disabled')) {
			element.classList.remove('w3-disabled');
			element.disabled = false;
		}
	}
</script>
</body>

</html>